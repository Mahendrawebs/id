var ImgCache={options:{debug:!1,localCacheFolder:"imgcache",useDataURI:!1,chromeQuota:10485760,usePersistentCache:!0},version:.5};!function(){function e(e){function t(e,t,o){for(;0<o--;)e.push(t)}function o(e,t){return e<<t|e>>>32-t}function n(e,t,o){return e^t^o}function r(e,t){var o=(65535&t)+(65535&e),n=(t>>>16)+(e>>>16)+(o>>>16);return(65535&n)<<16|65535&o}var a="0123456789abcdef";return function(e){for(var t,o=[],n=4*e.length,r=0;n>r;r++)t=e[r>>2]>>8*(3-r%4),o.push(a.charAt(t>>4&15)+a.charAt(15&t));return o.join("")}(function(e,a){var i,c,s,u,l,f=e.length,d=1732584193,h=4023233417,m=2562383102,g=271733878,I=3285377520,C=[];t(C,1518500249,20),t(C,1859775393,20),t(C,2400959708,20),t(C,3395469782,20),e[a>>5]|=128<<24-a%32,e[(a+65>>9<<4)+15]=a;for(var w=0;f>w;w+=16){i=d,c=h,s=m,u=g,l=I;for(var y=0,p=[];80>y;y++){p[y]=16>y?e[y+w]:o(p[y-3]^p[y-8]^p[y-14]^p[y-16],1);var v=function(e,t,o,n,r){var a=(65535&r)+(65535&e)+(65535&t)+(65535&o)+(65535&n),i=(r>>>16)+(e>>>16)+(t>>>16)+(o>>>16)+(n>>>16)+(a>>>16);return(65535&i)<<16|65535&a}(20>y?function(e,t,o){return e&t^~e&o}(c,s,u):40>y?n(c,s,u):60>y?function(e,t,o){return e&t^e&o^t&o}(c,s,u):n(c,s,u),l,C[y],p[y],o(i,5));l=u,u=s,s=o(c,30),c=i,i=v}d=r(d,i),h=r(h,c),m=r(m,s),g=r(g,u),I=r(I,l)}return[d,h,m,g,I]}(function(e){for(var t=[],o=255,n=8*e.length,r=0;n>r;r+=8)t[r>>5]|=(e.charCodeAt(r/8)&o)<<24-r%32;return t}(e).slice(),8*e.length))}var t="data-old-src",o=function(){return"undefined"!=typeof cordova||"undefined"!=typeof phonegap},n=function(e,t){ImgCache.options.debug&&(ImgCache.options.customLogger?ImgCache.options.customLogger(e,t):(1==t&&(e="INFO: "+e),2==t&&(e="WARN: "+e),3==t&&(e="ERROR: "+e),console.log(e)))},r=function(e){if(e){var t=e.lastIndexOf("/");if(t)return e.substr(t+1).toLowerCase()}},a=function(e){if(!e)return"";var t=e.split(".").pop();return!t||t.length>4?"":t},i=function(t,o){var n=e(t),i=a(r(t)),c=n+(i?"."+i:"");return(o?o+"/":"")+c},c=function(e,o,n){e.attr("src",o),e.attr(t,n)},s=function(e){if(ImgCache.filesystem){var t=function(e){n("Failed to get/create local cache directory: "+e.code,3)},o=function(t){ImgCache.dirEntry=t,n("Local cache folder opened: "+t.fullPath,1),e&&e()};ImgCache.filesystem.root.getDirectory(ImgCache.options.localCacheFolder,{create:!0,exclusive:!1},o,t)}},u=function(e){o()&&(this.fileTransfer=new FileTransfer),this.filesystem=e};u.prototype.download=function(e,t,o,r){if(this.fileTransfer)return this.fileTransfer.download(e,t,o,r);var a=this.filesystem,i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="arraybuffer",i.onload=function(){!i.response||200!=i.status&&0!=i.status?n("Image "+e+" could not be downloaded - status: "+i.status,3):a.root.getFile(t,{create:!0},function(e){e.createWriter(function(t){t.onerror=r,t.onwriteend=function(){o(e)};var n=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,a=new n;a.append(i.response);var c=i.getResponseHeader("Content-type");t.write(a.getBlob(c),r)},r)},r)},i.onerror=function(){n("XHR error - Image "+e+" could not be downloaded - status: "+i.status,3)},i.send()};var l=function(e){return e.toURL?e.toURL():e.toURI()};ImgCache.init=function(e,t){ImgCache.init_callback=e;var r=function(e){n("LocalFileSystem opened",1),ImgCache.filesystem=e,s(ImgCache.init_callback)},a=function(e){n("Failed to initialise LocalFileSystem "+e.code,3),t&&t()};if(o()){var i=ImgCache.options.usePersistentCache?LocalFileSystem.PERSISTENT:LocalFileSystem.TEMPORARY;window.requestFileSystem(i,0,r,a)}else{if(window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem,window.storageInfo=window.storageInfo||window.webkitStorageInfo,!window.storageInfo)return n("Your browser does not support the html5 File API",2),void(t&&t());var c=ImgCache.options.chromeQuota,i=ImgCache.options.usePersistentCache?window.storageInfo.PERSISTENT:window.storageInfo.TEMPORARY;window.storageInfo.requestQuota(i,c,function(){window.requestFileSystem(i,c,r,a)},function(e){n("Failed to request quota: "+e.code,3),t&&t()})}},ImgCache.cacheFile=function(e,t,o){if(ImgCache.filesystem&&ImgCache.dirEntry&&e){var r=i(e,ImgCache.dirEntry.fullPath),a=new u(ImgCache.filesystem);a.download(e,r,function(e){n("Download complete: "+e.fullPath,1),e.setMetadata&&e.setMetadata(function(){n("com.apple.MobileBackup metadata set",1)},function(){n("com.apple.MobileBackup metadata could not be set",2)},{"com.apple.MobileBackup":1}),t&&t()},function(e){e.source&&n("Download error source: "+e.source,3),e.target&&n("Download error target: "+e.target,3),n("Download error code: "+e.code,3),o&&o()})}},ImgCache.isCached=function(e,t){if(ImgCache.filesystem&&ImgCache.dirEntry&&t){var o=i(e,ImgCache.dirEntry.fullPath),n=function(o){t(e,o)};ImgCache.filesystem.root.getFile(o,{create:!1},function(){n(!0)},function(){n(!1)})}},ImgCache.useOnlineFile=function(e){if(e){var o=e.attr(t);o&&e.attr("src",o),e.removeAttr(t)}},ImgCache.useCachedFile=function(e,t,o){if(ImgCache.filesystem&&ImgCache.dirEntry&&e){var a=e.attr("src"),s=r(a),u=i(a),f=function(r){if(ImgCache.options.useDataURI){var i=function(r){var i=new FileReader;i.onloadend=function(r){var i=r.target.result;return i?(c(e,i,a),n("File "+s+" loaded from cache",1),void(t&&t(e))):(n("File in cache "+s+" is empty",2),void(o&&o(e)))},i.readAsDataURL(r)},u=function(t){n("Failed to read file "+t.code,3),o&&o(e)};r.file(i,u)}else{var f=l(r);c(e,f,a),n("File "+s+" loaded from cache",1),t&&t(e)}},d=function(){n("File "+s+" not in cache",1),o&&o(e)};ImgCache.dirEntry.getFile(u,{create:!1},f,d)}},ImgCache.clearCache=function(e,t){return ImgCache.filesystem&&ImgCache.dirEntry?void ImgCache.dirEntry.removeRecursively(function(){n("Local cache cleared",1),s(e)},function(e){n("Failed to remove directory or its contents: "+e.code,3),t&&t()}):void n("ImgCache not loaded yet!",2)},ImgCache.getCacheFolderURI=function(){return ImgCache.filesystem&&ImgCache.dirEntry?l(ImgCache.dirEntry):void n("ImgCache not loaded yet!",2)}}(jQuery);
